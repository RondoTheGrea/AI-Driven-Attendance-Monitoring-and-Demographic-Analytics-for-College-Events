<!-- Overview Tab Content -->
<div class="tab-content overview-tab">
    <div class="content-header">
        <h2>Dashboard</h2>
    </div>
    <!-- Top Section: AI Summary + Graph -->
    <section id="top">
        <section id="aib">
            <div class="arrival-card">
                <h3 class="arrival-title">Arrival Pattern &ndash; Last Event</h3>

                {% if arrival_event %}
                <p class="arrival-caption">
                    Based on {{ arrival_event.title }} ({{ arrival_event.event_date|date:"M d, Y" }})
                </p>

                {% if arrival_stats.total %}
                <div class="arrival-bar-track">
                    <div class="arrival-bar-segment early" style="width: {{ arrival_stats.early_percent }}%;"></div>
                    <div class="arrival-bar-segment on-time" style="width: {{ arrival_stats.on_time_percent }}%;"></div>
                    <div class="arrival-bar-segment late" style="width: {{ arrival_stats.late_percent }}%;"></div>
                </div>

                <div class="arrival-legend">
                    <span class="arrival-dot early"></span>
                    <span>Early (5+ min before start)</span>
                    <span class="arrival-dot on-time"></span>
                    <span>On-time (within 10 min)</span>
                    <span class="arrival-dot late"></span>
                    <span>Late (&gt; 10 min after)</span>
                </div>

                <p class="arrival-summary">
                    {{ arrival_stats.total }} students checked in; median arrival {{ arrival_stats.median_label }}.
                </p>
                {% else %}
                <p class="arrival-empty">
                    No check-ins recorded for this event yet.
                </p>
                {% endif %}
                {% else %}
                <p class="arrival-empty">
                    No events with attendance data yet.
                </p>
                {% endif %}
            </div>
        </section>
        <section id="graph">
            <div class="risk-graph">
                <h3>Risk Breakdown</h3>
                <p class="risk-graph-caption">
                    Based on {{ risk_counts.total_events }} past events with attendance data.
                </p>

                <div class="risk-bar-row">
                    <div class="risk-bar-label">
                        <span class="risk-color high-risk"></span>
                        <span>High-risk (&lt; 70% attendance)</span>
                    </div>
                    <div class="risk-bar-track">
                        <div class="risk-bar-fill high-risk" style="width: {{ risk_counts.high_percent }}%;"></div>
                    </div>
                    <span class="risk-bar-value">
                        {{ risk_counts.high }} ({{ risk_counts.high_percent }}%)
                    </span>
                </div>

                <div class="risk-bar-row">
                    <div class="risk-bar-label">
                        <span class="risk-color emerging-risk"></span>
                        <span>Emerging-risk (2+ absences in 10 days)</span>
                    </div>
                    <div class="risk-bar-track">
                        <div class="risk-bar-fill emerging-risk" style="width: {{ risk_counts.emerging_percent }}%;"></div>
                    </div>
                    <span class="risk-bar-value">
                        {{ risk_counts.emerging }} ({{ risk_counts.emerging_percent }}%)
                    </span>
                </div>

                <div class="risk-bar-row">
                    <div class="risk-bar-label">
                        <span class="risk-color low-risk"></span>
                        <span>Low-risk (occasional absences)</span>
                    </div>
                    <div class="risk-bar-track">
                        <div class="risk-bar-fill low-risk" style="width: {{ risk_counts.low_percent }}%;"></div>
                    </div>
                    <span class="risk-bar-value">
                        {{ risk_counts.low }} ({{ risk_counts.low_percent }}%)
                    </span>
                </div>

                <p class="risk-graph-summary">
                    {{ risk_counts.total_students }} students analyzed.
                </p>
            </div>
        </section>
    </section>

    <!-- Bottom Section: Quick Actions + Risk Indicators + Student List -->
    <section id="bottom">
        <section id="as">
            <!-- Sidebar with Risk Indicators and Live Event -->
            <aside>
                <!-- LIVE EVENT TAB -->
                <section id="live-event-section" class="live-event-sidebar">
                    <h3>ðŸ”´ Live Event</h3>
                    {% if active_event %}
                    <div class="live-event-meta">
                        <span class="live-event-title">{{ active_event.title }}</span>
                        <span class="live-event-time">{{ active_event.start_time|time:"H:i" }} - {{ active_event.end_time|time:"H:i" }}</span>
                    </div>
                    {% else %}
                    <div class="live-event-meta empty">No event currently live.</div>
                    {% endif %}
                    
                    <div class="live-feed">
                        {% if active_event %}
                        <div class="live-feed-list" id="attendance-feed" data-event-id="{{ active_event.id }}">
                            {% for log in recent_logs %}
                            <div class="feed-item">
                                <div class="feed-time">{{ log.timestamp|time:"H:i:s" }}</div>
                                <div class="feed-info">
                                    <strong>{{ log.student.first_name }} {{ log.student.last_name }}</strong>
                                    <span class="feed-note">Checked in</span>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="empty-feed">Start an event to see live check-ins.</div>
                        {% endif %}
                    </div>
                </section>
            </aside>

            <!-- Main Student List -->
            <section id="list">
                <div class="flex">
                    <form method="get" 
                          hx-get="{% url 'org-dashboard-overview' %}" 
                          hx-target="#students" 
                          hx-swap="innerHTML"
                          hx-trigger="input changed delay:300ms from:find input[name='search']"
                          class="search-form">
                        <input type="text" 
                               name="search" 
                               placeholder="Search Student Name or ID..." 
                               value="{{ search_query }}"
                               class="student-search-input">
                    </form>
                </div>

                <section id="student-list">
                    <table class="students-table">
                        <thead>
                            <tr>
                                <th>Student Name</th>
                                <th>Student Number</th>
                                <th>AI Flag</th>
                            </tr>
                        </thead>
                    </table>

                    <div id="students" class="students-container">
                        {% include 'org/overview/_student_list.html' %}
                    </div>
                </section>
            </section>
                    </section>
                </section>
            </div>
